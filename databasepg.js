const { Client } = require("pg");

// –ò—Å–ø–æ–ª—å–∑—É–µ–º DATABASE_URL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
// –ê –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
const connectionString = process.env.DATABASE_URL;

const client = new Client({
  // ‚ùóÔ∏è Render/Heroku –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç URL –≤ process.env.DATABASE_URL
  connectionString: connectionString, 
  
  // ‚ùóÔ∏è SSL –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Render
  ssl: connectionString ? { rejectUnauthorized: false } : false, 

  // üëá –≠—Ç–æ—Ç –±–ª–æ–∫ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ process.env.DATABASE_URL –Ω–µ –Ω–∞–π–¥–µ–Ω
  ...(!connectionString && {
    host: "localhost",
    user: "postgres",
    port: 5432,
    password: "1234",
    database: "postgres",
  })
});


// --- ‚ùóÔ∏è –ù–û–í–´–ô –ì–õ–û–ë–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö –ö–õ–ò–ï–ù–¢–ê PG ---
// –≠—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—É–¥–µ—Ç –ª–æ–≤–∏—Ç—å –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç
// –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑—Ä—ã–≤ —Å–µ—Ç–∏, —Ç–∞–π–º-–∞—É—Ç—ã).
client.on('error', (err) => {
  console.error('‚ùóÔ∏è –ù–ï–û–ñ–ò–î–ê–ù–ù–ê–Ø –û–®–ò–ë–ö–ê –ö–õ–ò–ï–ù–¢–ê POSTGRESQL (–≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã):');
  console.error(err.message, err.stack);
  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è,
  // –Ω–æ —á–∞—Å—Ç–æ –ª—É—á—à–µ –¥–∞—Ç—å Render –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å.
});

// (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–ª–æ—Å—å
client.on('end', () => {
  console.log('‚ÑπÔ∏è –ö–ª–∏–µ–Ω—Ç PostgreSQL —à—Ç–∞—Ç–Ω–æ –æ—Ç–∫–ª—é—á–∏–ª—Å—è.');
});
// --- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –û–ë–†–ê–ë–û–¢–ß–ò–ö–ê ---


// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
client.connect()
  .then(() => console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ PostgreSQL"))
  .catch(err => {
    // ‚ùóÔ∏è –£–õ–£–ß–®–ï–ù–ò–ï: –ï—Å–ª–∏ –º—ã –Ω–µ —Å–º–æ–≥–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –Ω–∞ —Å—Ç–∞—Ä—Ç–µ,
    // –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å.
    console.error("‚ùóÔ∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL:", err.stack);
    // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å, —Ç–∞–∫ –∫–∞–∫ –±–µ–∑ –ë–î –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ
    process.exit(1); 
  });

module.exports = client;